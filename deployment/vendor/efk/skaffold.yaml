apiVersion: skaffold/v2beta12
kind: Config
metadata:
  name: spring-microservices-poc
deploy:
  helm:
    releases:
      - name: cockroachdb
        chartPath: cockroachdb/cockroachdb
        remote: true
        namespace: cockroachdb
        createNamespace: true
        setValues:
          statefulset:
            replicas: 2
            resources:
              limits:
                memory: 4Gi
              requests:
                memory: 4Gi
          conf:
            cache: 1Gi
            max-sql-memory: 1Gi
          storage:
            persistentVolume:
              size: 32Gi

      - name: elasticsearch
        chartPath: elastic/elasticsearch
        remote: true
        namespace: efk
        createNamespace: true
        setValues:
          antiAffinity: soft
          replicas: "1"

      - name: kibana
        chartPath: elastic/kibana
        remote: true
        namespace: efk

  kubectl:
    manifests:
      - fluent-bit.yaml